<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="title: mongodb集群date: 2021-03-07 23:27:28categories:    - 中间件tags:    - mongodb mongodb集群副本集-Replica SetsMongoDB中的副本集（Replica Set）是一组维护相同数据集的mongod服务。 副本集可提供冗余和高可用性，是所有生产部署的基础。副本集类似于有自动故障恢复功能的主从集群。通俗的">
<meta property="og:type" content="article">
<meta property="og:title" content="mongodb集群">
<meta property="og:url" content="http://yoursite.com/2021/03/07/mongodb%E9%9B%86%E7%BE%A4/index.html">
<meta property="og:site_name" content="码上有解">
<meta property="og:description" content="title: mongodb集群date: 2021-03-07 23:27:28categories:    - 中间件tags:    - mongodb mongodb集群副本集-Replica SetsMongoDB中的副本集（Replica Set）是一组维护相同数据集的mongod服务。 副本集可提供冗余和高可用性，是所有生产部署的基础。副本集类似于有自动故障恢复功能的主从集群。通俗的">
<meta property="article:published_time" content="2021-03-07T15:18:37.645Z">
<meta property="article:modified_time" content="2021-03-07T15:31:55.052Z">
<meta property="article:author" content="Haiyefeng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2021/03/07/mongodb%E9%9B%86%E7%BE%A4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>mongodb集群 | 码上有解</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">码上有解</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-history"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-list"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/03/07/mongodb%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/a.jpg">
      <meta itemprop="name" content="Haiyefeng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码上有解">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          mongodb集群
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-03-07 23:18:37 / 修改时间：23:31:55" itemprop="dateCreated datePublished" datetime="2021-03-07T23:18:37+08:00">2021-03-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>title: mongodb集群<br>date: 2021-03-07 23:27:28<br>categories:<br>    - 中间件<br>tags:<br>    - mongodb</p>
<h1 id="mongodb集群"><a href="#mongodb集群" class="headerlink" title="mongodb集群"></a>mongodb集群</h1><h2 id="副本集-Replica-Sets"><a href="#副本集-Replica-Sets" class="headerlink" title="副本集-Replica Sets"></a>副本集-Replica Sets</h2><p>MongoDB中的副本集（Replica Set）是一组维护相同数据集的mongod服务。 副本集可提供冗余和高可用性，是所有生产部署的基础。<br>副本集类似于有自动故障恢复功能的主从集群。通俗的讲就是用多台机器进行同一数据的异步同步，从而使多台机器拥有同一数据的多个副本，并且当主库当掉时在不需要用户干预的情况下自动切换其他备份服务器做主库。而且还可以利用副本服务器做只读服务器，实现读写分离，提高负载。<br>（1）冗余和数据可用性<br>复制提供冗余并提高数据可用性。 通过在不同数据库服务器上提供多个数据副本，复制可提供一定级别的容错功能，以防止丢失单个数据库服务器。<br>在某些情况下，复制可以提供增加的读取性能，因为客户端可以将读取操作发送到不同的服务上， 在不同数据中心维护数据副本可以增加分布式应用程序的数据位置和可用性。<br>（2）MongoDB中的复制<br>副本集是一组维护相同数据集的mongod实例。 副本集包含多个数据承载节点和可选的一个仲裁节点。在承载数据的节点中，一个且仅一个成员被视为主节点，而其他节点被视为次要（从）节点。<br>主节点接收所有写操作。 副本集只能有一个主要能够确认具有{w：“most”}写入关注的写入; 虽然在某些情况下，另一个mongod实例可能暂时认为自己也是主要的。主要记录其操作日志中的数据集的所有更改，即oplog。辅助(副本)节点复制主节点的oplog并将操作应用于其数据集，以使辅助节点的数据集反映主节点的数据集。 如果主要人员不在，则符合条件的中学将举行选举以选出新的主要人员。<br>![副本集的复制](mongodb集群/20210304194325736_10252.png =852x)<br>（3）主从复制和副本集区别<br>主从集群和副本集最大的区别就是副本集没有固定的“主节点”；整个集群会选出一个“主节点”，当其挂掉后，又在剩下的从节点中选中其他节点为“主节点”，副本集总有一个活跃点(主、primary)和一个或多个备份节点(从、secondary)。</p>
<h3 id="副本集的三个角色"><a href="#副本集的三个角色" class="headerlink" title="副本集的三个角色"></a>副本集的三个角色</h3><p>副本集有两种类型三种角色</p>
<h4 id="两种类型："><a href="#两种类型：" class="headerlink" title="两种类型："></a>两种类型：</h4><ul>
<li>主节点（Primary）类型：数据操作的主要连接点，可读写。</li>
<li>次要（辅助、从）节点（Secondaries）类型：数据冗余备份节点，可以读或选举。<h4 id="三种角色："><a href="#三种角色：" class="headerlink" title="三种角色："></a>三种角色：</h4></li>
<li>主要成员（Primary）：主要接收所有写操作。就是主节点。</li>
<li>副本成员（Replicate）：从主节点通过复制操作以维护相同的数据集，即备份数据，不可写操作，但可以读操作（但需要配置）。是默认的一种从节点类型。</li>
<li>仲裁者（Arbiter）：不保留任何数据的副本，只具有投票选举作用。当然也可以将仲裁服务器维护为副本集的一部分，即副本成员同时也可以是仲裁者。也是一种从节点类型。<br>![角色关系](mongodb集群/20210304194248627_19146.png =752x)<h4 id="仲裁者"><a href="#仲裁者" class="headerlink" title="仲裁者"></a>仲裁者</h4>可以将额外的mongod实例添加到副本集作为仲裁者。<br>仲裁者不维护数据集。 仲裁者的目的是通过响应其他副本集成员的心跳和选举请求来维护副本集中的仲裁。 因为它们不存储数据集，所以仲裁器可以是提供副本集仲裁功能的好方法，其资源成本比具有数据集的全功能副本集成员更便宜。<br>如果您的副本集具有偶数个成员，请添加仲裁者以获得主要选举中的“大多数”投票。 仲裁者不需要专用硬件。<br>仲裁者将永远是仲裁者，而主要人员可能会退出并成为次要人员，而次要人员可能成为选举期间的主要人员。<br>如果你的副本+主节点的个数是偶数，建议加一个仲裁者，形成奇数，容易满足大多数的投票。<br>如果你的副本+主节点的个数是奇数，可以不加仲裁者。<h3 id="副本集的创建"><a href="#副本集的创建" class="headerlink" title="副本集的创建"></a>副本集的创建</h3><h4 id="创建文件目录及配置文件"><a href="#创建文件目录及配置文件" class="headerlink" title="创建文件目录及配置文件"></a>创建文件目录及配置文件</h4>1、新建一个副本集文件夹<br>![副本集](mongodb集群/20210304225548234_14966.png =800x)<br>2、新建三个节点文件夹<br>![节点文件夹](mongodb集群/20210304225705249_31638.png =800x)<br>3、创建三个节点的配置文件<br>主节点：<br>![主节点文件目录](mongodb集群/20210304230352840_10829.png =800x)<br>myrs_27018 – data – db<pre><code>-- log
-- mongod.conf</code></pre><blockquote>
<p>mongod.conf</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">#MongoDB发送所有日志输出的目标指定为文件</span><br><span class="line">destination: file</span><br><span class="line">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span><br><span class="line">path: &quot;D:\software\MongoDB\Server\4.4\replica_sets\myrs_27018\log\mongod.log&quot;</span><br><span class="line">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span><br><span class="line">logAppend: true</span><br><span class="line">storage:</span><br><span class="line">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span><br><span class="line">dbPath: &quot;D:\software\MongoDB\Server\4.4\replica_sets\myrs_27018\data\db&quot;</span><br><span class="line">journal:</span><br><span class="line">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span><br><span class="line">enabled: true</span><br><span class="line">processManagement:</span><br><span class="line">#启用在后台运行mongos或mongod进程的守护进程模式。</span><br><span class="line">fork: true</span><br><span class="line">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span><br><span class="line">pidFilePath: &quot;D:\software\MongoDB\Server\4.4\replica_sets\myrs_27018\log\mongod.pid&quot;</span><br><span class="line">net:</span><br><span class="line">#服务实例绑定所有IP，有副作用，副本集初始化的时候，节点名字会自动设置为本地域名，而不是ip</span><br><span class="line">#bindIpAll: true</span><br><span class="line">#服务实例绑定的IP</span><br><span class="line">bindIp: localhost</span><br><span class="line">#bindIp</span><br><span class="line">#绑定的端口</span><br><span class="line">port: 27018</span><br><span class="line">replication:</span><br><span class="line">#副本集的名称</span><br><span class="line">replSetName: myrs</span><br></pre></td></tr></table></figure>
其他两个节点将27018改为27019、27020即可<h4 id="启动节点"><a href="#启动节点" class="headerlink" title="启动节点"></a>启动节点</h4>执行以下命令：<br><code>D:\software\MongoDB\Server\4.4\bin\mongod -f D:\software\MongoDB\Server\4.4\replica_sets\myrs_27019\mongod.conf</code><br>常见报错：<br>1、格式<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Error parsing YAML config file: yaml-cpp: error at line 5, column 16: unknown escape character: s</span><br><span class="line">try &#39;D:\software\MongoDB\Server\4.4\bin\mongod --help&#39; for more information</span><br><span class="line">没遵循yaml文件写法，配置文件需要空四格作为缩进</span><br></pre></td></tr></table></figure>
2、Unrecognized option: processManagement.fork<br>不能在配置文件加入这些配置<br>![](mongodb集群/20210305002132837_16013.png =800x)<br>启动成功后应创建数据库相关文件<h4 id="初始化配置副本集和主节点"><a href="#初始化配置副本集和主节点" class="headerlink" title="初始化配置副本集和主节点"></a>初始化配置副本集和主节点</h4>1、连接主节点<br><code>D:\software\MongoDB\Server\4.4\bin&gt;mongo --host=127.0.0.1 --port=27018</code><br>2、初始化副本集<br>![初始化副本集命令](mongodb集群/20210305003129281_768.png =800x)<br><code>rs.initiate()</code><br>![副本集初始化](mongodb集群/20210305003431166_16913.png =800x)<br>1）“ok”的值为1，说明创建成功。<br>2）命令行提示符发生变化，变成了一个从节点角色，此时默认不能读写。稍等片刻，回车，变成主节<br>点。<h4 id="查看副本集的配置内容"><a href="#查看副本集的配置内容" class="headerlink" title="查看副本集的配置内容"></a>查看副本集的配置内容</h4>![查看配置](mongodb集群/20210305003544703_21395.png =800x)<br>![配置信息](mongodb集群/20210305004307166_20285.png =800x)<blockquote>
<p>副本集配置的查看命令，本质是查询的是 system.replset 的表中的数据：db.system.replset.find()</p>
</blockquote>
<h4 id="查看副本集状态"><a href="#查看副本集状态" class="headerlink" title="查看副本集状态"></a>查看副本集状态</h4>![查看副本集状态](mongodb集群/20210305004540976_21727.png =800x)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        &quot;set&quot; : &quot;myrs&quot;,</span><br><span class="line">        &quot;date&quot; : ISODate(&quot;2021-03-04T16:46:03.973Z&quot;),</span><br><span class="line">        &quot;myState&quot; : 1,</span><br><span class="line">        &quot;term&quot; : NumberLong(1),</span><br><span class="line">        &quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">        &quot;syncSourceId&quot; : -1,</span><br><span class="line">        &quot;heartbeatIntervalMillis&quot; : NumberLong(2000),</span><br><span class="line">        &quot;majorityVoteCount&quot; : 1,</span><br><span class="line">        &quot;writeMajorityCount&quot; : 1,</span><br><span class="line">        &quot;votingMembersCount&quot; : 1,</span><br><span class="line">        &quot;writableVotingMembersCount&quot; : 1,</span><br><span class="line">        &quot;optimes&quot; : &#123;</span><br><span class="line">                &quot;lastCommittedOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876359, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;lastCommittedWallTime&quot; : ISODate(&quot;2021-03-04T16:45:59.614Z&quot;),</span><br><span class="line">                &quot;readConcernMajorityOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876359, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;readConcernMajorityWallTime&quot; : ISODate(&quot;2021-03-04T16:45:59.614Z&quot;),</span><br><span class="line">                &quot;appliedOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876359, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;durableOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876359, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;lastAppliedWallTime&quot; : ISODate(&quot;2021-03-04T16:45:59.614Z&quot;),</span><br><span class="line">                &quot;lastDurableWallTime&quot; : ISODate(&quot;2021-03-04T16:45:59.614Z&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;lastStableRecoveryTimestamp&quot; : Timestamp(1614876359, 1),</span><br><span class="line">        &quot;electionCandidateMetrics&quot; : &#123;</span><br><span class="line">                &quot;lastElectionReason&quot; : &quot;electionTimeout&quot;,</span><br><span class="line">                &quot;lastElectionDate&quot; : ISODate(&quot;2021-03-04T16:31:59.529Z&quot;),</span><br><span class="line">                &quot;electionTerm&quot; : NumberLong(1),</span><br><span class="line">                &quot;lastCommittedOpTimeAtElection&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(0, 0),</span><br><span class="line">                        &quot;t&quot; : NumberLong(-1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;lastSeenOpTimeAtElection&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614875519, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(-1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;numVotesNeeded&quot; : 1,</span><br><span class="line">                &quot;priorityAtElection&quot; : 1,</span><br><span class="line">                &quot;electionTimeoutMillis&quot; : NumberLong(10000),</span><br><span class="line">                &quot;newTermStartDate&quot; : ISODate(&quot;2021-03-04T16:31:59.542Z&quot;),</span><br><span class="line">                &quot;wMajorityWriteAvailabilityDate&quot; : ISODate(&quot;2021-03-04T16:31:59.559Z&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;members&quot; : [</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 0,</span><br><span class="line">                        &quot;name&quot; : &quot;localhost:27018&quot;,</span><br><span class="line">                        &quot;health&quot; : 1,</span><br><span class="line">                        &quot;state&quot; : 1,</span><br><span class="line">                        &quot;stateStr&quot; : &quot;PRIMARY&quot;,</span><br><span class="line">                        &quot;uptime&quot; : 2166,</span><br><span class="line">                        &quot;optime&quot; : &#123;</span><br><span class="line">                                &quot;ts&quot; : Timestamp(1614876359, 1),</span><br><span class="line">                                &quot;t&quot; : NumberLong(1)</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;optimeDate&quot; : ISODate(&quot;2021-03-04T16:45:59Z&quot;),</span><br><span class="line">                        &quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;syncSourceId&quot; : -1,</span><br><span class="line">                        &quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;electionTime&quot; : Timestamp(1614875519, 2),</span><br><span class="line">                        &quot;electionDate&quot; : ISODate(&quot;2021-03-04T16:31:59Z&quot;),</span><br><span class="line">                        &quot;configVersion&quot; : 1,</span><br><span class="line">                        &quot;configTerm&quot; : 1,</span><br><span class="line">                        &quot;self&quot; : true,</span><br><span class="line">                        &quot;lastHeartbeatMessage&quot; : &quot;&quot;</span><br><span class="line">                &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;ok&quot; : 1,</span><br><span class="line">        &quot;$clusterTime&quot; : &#123;</span><br><span class="line">                &quot;clusterTime&quot; : Timestamp(1614876359, 1),</span><br><span class="line">                &quot;signature&quot; : &#123;</span><br><span class="line">                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">                        &quot;keyId&quot; : NumberLong(0)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;operationTime&quot; : Timestamp(1614876359, 1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
说明：<br>1） “set” : “myrs” ：副本集的名字<br>2） “myState” : 1：说明状态正常<br>3） “members” ：副本集成员数组，此时只有一个： “name” : “localhost:27018” ，该成员的<br>角色是 “stateStr” : “PRIMARY”, 该节点是健康的： “health” : 1 。<h4 id="添加副本从节点"><a href="#添加副本从节点" class="headerlink" title="添加副本从节点"></a>添加副本从节点</h4>![添加从节点](mongodb集群/20210305004801083_32398.png =800x)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">myrs:PRIMARY&gt; rs.add(&quot;localhost:27019&quot;)</span><br><span class="line">&#123;</span><br><span class="line">        &quot;ok&quot; : 1,</span><br><span class="line">        &quot;$clusterTime&quot; : &#123;</span><br><span class="line">                &quot;clusterTime&quot; : Timestamp(1614876534, 1),</span><br><span class="line">                &quot;signature&quot; : &#123;</span><br><span class="line">                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">                        &quot;keyId&quot; : NumberLong(0)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;operationTime&quot; : Timestamp(1614876534, 1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
说明：<br>1） “ok” : 1 ：说明添加成功。<br>查看副本集状态<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        &quot;set&quot; : &quot;myrs&quot;,</span><br><span class="line">        &quot;date&quot; : ISODate(&quot;2021-03-04T16:50:35.854Z&quot;),</span><br><span class="line">        &quot;myState&quot; : 1,</span><br><span class="line">        &quot;term&quot; : NumberLong(1),</span><br><span class="line">        &quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">        &quot;syncSourceId&quot; : -1,</span><br><span class="line">        &quot;heartbeatIntervalMillis&quot; : NumberLong(2000),</span><br><span class="line">        &quot;majorityVoteCount&quot; : 2,</span><br><span class="line">        &quot;writeMajorityCount&quot; : 2,</span><br><span class="line">        &quot;votingMembersCount&quot; : 2,</span><br><span class="line">        &quot;writableVotingMembersCount&quot; : 2,</span><br><span class="line">        &quot;optimes&quot; : &#123;</span><br><span class="line">                &quot;lastCommittedOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876629, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;lastCommittedWallTime&quot; : ISODate(&quot;2021-03-04T16:50:29.634Z&quot;),</span><br><span class="line">                &quot;readConcernMajorityOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876629, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;readConcernMajorityWallTime&quot; : ISODate(&quot;2021-03-04T16:50:29.634Z&quot;),</span><br><span class="line">                &quot;appliedOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876629, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;durableOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876629, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;lastAppliedWallTime&quot; : ISODate(&quot;2021-03-04T16:50:29.634Z&quot;),</span><br><span class="line">                &quot;lastDurableWallTime&quot; : ISODate(&quot;2021-03-04T16:50:29.634Z&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;lastStableRecoveryTimestamp&quot; : Timestamp(1614876598, 1),</span><br><span class="line">        &quot;electionCandidateMetrics&quot; : &#123;</span><br><span class="line">                &quot;lastElectionReason&quot; : &quot;electionTimeout&quot;,</span><br><span class="line">                &quot;lastElectionDate&quot; : ISODate(&quot;2021-03-04T16:31:59.529Z&quot;),</span><br><span class="line">                &quot;electionTerm&quot; : NumberLong(1),</span><br><span class="line">                &quot;lastCommittedOpTimeAtElection&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(0, 0),</span><br><span class="line">                        &quot;t&quot; : NumberLong(-1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;lastSeenOpTimeAtElection&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614875519, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(-1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;numVotesNeeded&quot; : 1,</span><br><span class="line">                &quot;priorityAtElection&quot; : 1,</span><br><span class="line">                &quot;electionTimeoutMillis&quot; : NumberLong(10000),</span><br><span class="line">                &quot;newTermStartDate&quot; : ISODate(&quot;2021-03-04T16:31:59.542Z&quot;),</span><br><span class="line">                &quot;wMajorityWriteAvailabilityDate&quot; : ISODate(&quot;2021-03-04T16:31:59.559Z&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;members&quot; : [</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 0,</span><br><span class="line">                        &quot;name&quot; : &quot;localhost:27018&quot;,</span><br><span class="line">                        &quot;health&quot; : 1,</span><br><span class="line">                        &quot;state&quot; : 1,</span><br><span class="line">                        &quot;stateStr&quot; : &quot;PRIMARY&quot;,</span><br><span class="line">                        &quot;uptime&quot; : 2438,</span><br><span class="line">                        &quot;optime&quot; : &#123;</span><br><span class="line">                                &quot;ts&quot; : Timestamp(1614876629, 1),</span><br><span class="line">                                &quot;t&quot; : NumberLong(1)</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;optimeDate&quot; : ISODate(&quot;2021-03-04T16:50:29Z&quot;),</span><br><span class="line">                        &quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;syncSourceId&quot; : -1,</span><br><span class="line">                        &quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;electionTime&quot; : Timestamp(1614875519, 2),</span><br><span class="line">                        &quot;electionDate&quot; : ISODate(&quot;2021-03-04T16:31:59Z&quot;),</span><br><span class="line">                        &quot;configVersion&quot; : 2,</span><br><span class="line">                        &quot;configTerm&quot; : 1,</span><br><span class="line">                        &quot;self&quot; : true,</span><br><span class="line">                        &quot;lastHeartbeatMessage&quot; : &quot;&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 1,</span><br><span class="line">                        &quot;name&quot; : &quot;localhost:27019&quot;,</span><br><span class="line">                        &quot;health&quot; : 1,</span><br><span class="line">                        &quot;state&quot; : 2,</span><br><span class="line">                        &quot;stateStr&quot; : &quot;SECONDARY&quot;,</span><br><span class="line">                        &quot;uptime&quot; : 100,</span><br><span class="line">                        &quot;optime&quot; : &#123;</span><br><span class="line">                                &quot;ts&quot; : Timestamp(1614876629, 1),</span><br><span class="line">                                &quot;t&quot; : NumberLong(1)</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;optimeDurable&quot; : &#123;</span><br><span class="line">                                &quot;ts&quot; : Timestamp(1614876629, 1),</span><br><span class="line">                                &quot;t&quot; : NumberLong(1)</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;optimeDate&quot; : ISODate(&quot;2021-03-04T16:50:29Z&quot;),</span><br><span class="line">                        &quot;optimeDurableDate&quot; : ISODate(&quot;2021-03-04T16:50:29Z&quot;),</span><br><span class="line">                        &quot;lastHeartbeat&quot; : ISODate(&quot;2021-03-04T16:50:34.931Z&quot;),</span><br><span class="line">                        &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2021-03-04T16:50:35.059Z&quot;),</span><br><span class="line">                        &quot;pingMs&quot; : NumberLong(0),</span><br><span class="line">                        &quot;lastHeartbeatMessage&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;syncSourceHost&quot; : &quot;localhost:27018&quot;,</span><br><span class="line">                        &quot;syncSourceId&quot; : 0,</span><br><span class="line">                        &quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;configVersion&quot; : 2,</span><br><span class="line">                        &quot;configTerm&quot; : 1</span><br><span class="line">                &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;ok&quot; : 1,</span><br><span class="line">        &quot;$clusterTime&quot; : &#123;</span><br><span class="line">                &quot;clusterTime&quot; : Timestamp(1614876629, 1),</span><br><span class="line">                &quot;signature&quot; : &#123;</span><br><span class="line">                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">                        &quot;keyId&quot; : NumberLong(0)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;operationTime&quot; : Timestamp(1614876629, 1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
说明：<br>1） “name” : “localhost:27019” 是第二个节点的名字，其角色是 “stateStr” :”SECONDARY”<h4 id="添加仲裁从节点"><a href="#添加仲裁从节点" class="headerlink" title="添加仲裁从节点"></a>添加仲裁从节点</h4>![添加仲裁节点](mongodb集群/20210305005253591_9329.png =800x)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">myrs:PRIMARY&gt; rs.addArb(&quot;localhost:27020&quot;)</span><br><span class="line">&#123;</span><br><span class="line">        &quot;ok&quot; : 1,</span><br><span class="line">        &quot;$clusterTime&quot; : &#123;</span><br><span class="line">                &quot;clusterTime&quot; : Timestamp(1614876802, 1),</span><br><span class="line">                &quot;signature&quot; : &#123;</span><br><span class="line">                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">                        &quot;keyId&quot; : NumberLong(0)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;operationTime&quot; : Timestamp(1614876802, 1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
查看副本集状态：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        &quot;set&quot; : &quot;myrs&quot;,</span><br><span class="line">        &quot;date&quot; : ISODate(&quot;2021-03-04T16:53:46.643Z&quot;),</span><br><span class="line">        &quot;myState&quot; : 1,</span><br><span class="line">        &quot;term&quot; : NumberLong(1),</span><br><span class="line">        &quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">        &quot;syncSourceId&quot; : -1,</span><br><span class="line">        &quot;heartbeatIntervalMillis&quot; : NumberLong(2000),</span><br><span class="line">        &quot;majorityVoteCount&quot; : 2,</span><br><span class="line">        &quot;writeMajorityCount&quot; : 2,</span><br><span class="line">        &quot;votingMembersCount&quot; : 3,</span><br><span class="line">        &quot;writableVotingMembersCount&quot; : 2,</span><br><span class="line">        &quot;optimes&quot; : &#123;</span><br><span class="line">                &quot;lastCommittedOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876819, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;lastCommittedWallTime&quot; : ISODate(&quot;2021-03-04T16:53:39.646Z&quot;),</span><br><span class="line">                &quot;readConcernMajorityOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876819, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;readConcernMajorityWallTime&quot; : ISODate(&quot;2021-03-04T16:53:39.646Z&quot;),</span><br><span class="line">                &quot;appliedOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876819, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;durableOpTime&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614876819, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;lastAppliedWallTime&quot; : ISODate(&quot;2021-03-04T16:53:39.646Z&quot;),</span><br><span class="line">                &quot;lastDurableWallTime&quot; : ISODate(&quot;2021-03-04T16:53:39.646Z&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;lastStableRecoveryTimestamp&quot; : Timestamp(1614876779, 1),</span><br><span class="line">        &quot;electionCandidateMetrics&quot; : &#123;</span><br><span class="line">                &quot;lastElectionReason&quot; : &quot;electionTimeout&quot;,</span><br><span class="line">                &quot;lastElectionDate&quot; : ISODate(&quot;2021-03-04T16:31:59.529Z&quot;),</span><br><span class="line">                &quot;electionTerm&quot; : NumberLong(1),</span><br><span class="line">                &quot;lastCommittedOpTimeAtElection&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(0, 0),</span><br><span class="line">                        &quot;t&quot; : NumberLong(-1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;lastSeenOpTimeAtElection&quot; : &#123;</span><br><span class="line">                        &quot;ts&quot; : Timestamp(1614875519, 1),</span><br><span class="line">                        &quot;t&quot; : NumberLong(-1)</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;numVotesNeeded&quot; : 1,</span><br><span class="line">                &quot;priorityAtElection&quot; : 1,</span><br><span class="line">                &quot;electionTimeoutMillis&quot; : NumberLong(10000),</span><br><span class="line">                &quot;newTermStartDate&quot; : ISODate(&quot;2021-03-04T16:31:59.542Z&quot;),</span><br><span class="line">                &quot;wMajorityWriteAvailabilityDate&quot; : ISODate(&quot;2021-03-04T16:31:59.559Z&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;members&quot; : [</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 0,</span><br><span class="line">                        &quot;name&quot; : &quot;localhost:27018&quot;,</span><br><span class="line">                        &quot;health&quot; : 1,</span><br><span class="line">                        &quot;state&quot; : 1,</span><br><span class="line">                        &quot;stateStr&quot; : &quot;PRIMARY&quot;,</span><br><span class="line">                        &quot;uptime&quot; : 2629,</span><br><span class="line">                        &quot;optime&quot; : &#123;</span><br><span class="line">                                &quot;ts&quot; : Timestamp(1614876819, 1),</span><br><span class="line">                                &quot;t&quot; : NumberLong(1)</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;optimeDate&quot; : ISODate(&quot;2021-03-04T16:53:39Z&quot;),</span><br><span class="line">                        &quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;syncSourceId&quot; : -1,</span><br><span class="line">                        &quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;electionTime&quot; : Timestamp(1614875519, 2),</span><br><span class="line">                        &quot;electionDate&quot; : ISODate(&quot;2021-03-04T16:31:59Z&quot;),</span><br><span class="line">                        &quot;configVersion&quot; : 3,</span><br><span class="line">                        &quot;configTerm&quot; : 1,</span><br><span class="line">                        &quot;self&quot; : true,</span><br><span class="line">                        &quot;lastHeartbeatMessage&quot; : &quot;&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 1,</span><br><span class="line">                        &quot;name&quot; : &quot;localhost:27019&quot;,</span><br><span class="line">                        &quot;health&quot; : 1,</span><br><span class="line">                        &quot;state&quot; : 2,</span><br><span class="line">                        &quot;stateStr&quot; : &quot;SECONDARY&quot;,</span><br><span class="line">                        &quot;uptime&quot; : 291,</span><br><span class="line">                        &quot;optime&quot; : &#123;</span><br><span class="line">                                &quot;ts&quot; : Timestamp(1614876819, 1),</span><br><span class="line">                                &quot;t&quot; : NumberLong(1)</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;optimeDurable&quot; : &#123;</span><br><span class="line">                                &quot;ts&quot; : Timestamp(1614876819, 1),</span><br><span class="line">                                &quot;t&quot; : NumberLong(1)</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;optimeDate&quot; : ISODate(&quot;2021-03-04T16:53:39Z&quot;),</span><br><span class="line">                        &quot;optimeDurableDate&quot; : ISODate(&quot;2021-03-04T16:53:39Z&quot;),</span><br><span class="line">                        &quot;lastHeartbeat&quot; : ISODate(&quot;2021-03-04T16:53:46.271Z&quot;),</span><br><span class="line">                        &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2021-03-04T16:53:46.293Z&quot;),</span><br><span class="line">                        &quot;pingMs&quot; : NumberLong(0),</span><br><span class="line">                        &quot;lastHeartbeatMessage&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;syncSourceHost&quot; : &quot;localhost:27018&quot;,</span><br><span class="line">                        &quot;syncSourceId&quot; : 0,</span><br><span class="line">                        &quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;configVersion&quot; : 3,</span><br><span class="line">                        &quot;configTerm&quot; : 1</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 2,</span><br><span class="line">                        &quot;name&quot; : &quot;localhost:27020&quot;,</span><br><span class="line">                        &quot;health&quot; : 1,</span><br><span class="line">                        &quot;state&quot; : 7,</span><br><span class="line">                        &quot;stateStr&quot; : &quot;ARBITER&quot;,</span><br><span class="line">                        &quot;uptime&quot; : 24,</span><br><span class="line">                        &quot;lastHeartbeat&quot; : ISODate(&quot;2021-03-04T16:53:46.264Z&quot;),</span><br><span class="line">                        &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2021-03-04T16:53:46.307Z&quot;),</span><br><span class="line">                        &quot;pingMs&quot; : NumberLong(0),</span><br><span class="line">                        &quot;lastHeartbeatMessage&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;syncSourceHost&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;syncSourceId&quot; : -1,</span><br><span class="line">                        &quot;infoMessage&quot; : &quot;&quot;,</span><br><span class="line">                        &quot;configVersion&quot; : 3,</span><br><span class="line">                        &quot;configTerm&quot; : 1</span><br><span class="line">                &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;ok&quot; : 1,</span><br><span class="line">        &quot;$clusterTime&quot; : &#123;</span><br><span class="line">                &quot;clusterTime&quot; : Timestamp(1614876819, 1),</span><br><span class="line">                &quot;signature&quot; : &#123;</span><br><span class="line">                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">                        &quot;keyId&quot; : NumberLong(0)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;operationTime&quot; : Timestamp(1614876819, 1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
说明：<br>1） “name” : “localhost:27020” 是第二个节点的名字，其角色是 “stateStr” : “ARBITER”<h4 id="副本集的数据读写操作"><a href="#副本集的数据读写操作" class="headerlink" title="副本集的数据读写操作"></a>副本集的数据读写操作</h4>目标：测试三个不同角色的节点的数据读写情况。<br>1、主节点的读和写<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">myrs:PRIMARY&gt; use articledb</span><br><span class="line">switched to db articledb</span><br><span class="line">myrs:PRIMARY&gt; db</span><br><span class="line">articledb</span><br><span class="line">myrs:PRIMARY&gt; db.comment.insert(&#123;&quot;articleid&quot;:&quot;100000&quot;,&quot;content&quot;:&quot;今天天气真好，阳光明媚&quot;,&quot;userid&quot;:&quot;1001&quot;,&quot;nickname&quot;:&quot;Rose&quot;,&quot;createdatetime&quot;:new Date()&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">myrs:PRIMARY&gt; db.comment.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;6041130aaa5b546e2eba2dfd&quot;), &quot;articleid&quot; : &quot;100000&quot;, &quot;content&quot; : &quot;今天天气真好，阳光明媚&quot;, &quot;userid&quot; : &quot;1001&quot;, &quot;nickname&quot; : &quot;Rose&quot;, &quot;createdatetime&quot; : ISODate(&quot;2021-03-04T17:04:10.913Z&quot;) &#125;</span><br></pre></td></tr></table></figure>
2、从节点的读和写<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 登录从节点</span><br><span class="line">mongo --host&#x3D;127.0.0.1 --port&#x3D;27019</span><br><span class="line"># 查看数据库</span><br><span class="line">myrs:SECONDARY&gt; show dbs;</span><br><span class="line">uncaught exception: Error: listDatabases failed:&#123;</span><br><span class="line">        &quot;topologyVersion&quot; : &#123;</span><br><span class="line">                &quot;processId&quot; : ObjectId(&quot;6041058376f8cdece45c5d17&quot;),</span><br><span class="line">                &quot;counter&quot; : NumberLong(4)</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;operationTime&quot; : Timestamp(1614877588, 1),</span><br><span class="line">        &quot;ok&quot; : 0,</span><br><span class="line">        &quot;errmsg&quot; : &quot;not master and slaveOk&#x3D;false&quot;,</span><br><span class="line">        &quot;code&quot; : 13435,</span><br><span class="line">        &quot;codeName&quot; : &quot;NotPrimaryNoSecondaryOk&quot;,</span><br><span class="line">        &quot;$clusterTime&quot; : &#123;</span><br><span class="line">                &quot;clusterTime&quot; : Timestamp(1614877588, 1),</span><br><span class="line">                &quot;signature&quot; : &#123;</span><br><span class="line">                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">                        &quot;keyId&quot; : NumberLong(0)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125; :</span><br><span class="line">_getErrorWithCode@src&#x2F;mongo&#x2F;shell&#x2F;utils.js:25:13</span><br><span class="line">Mongo.prototype.getDBs&#x2F;&lt;@src&#x2F;mongo&#x2F;shell&#x2F;mongo.js:147:19</span><br><span class="line">Mongo.prototype.getDBs@src&#x2F;mongo&#x2F;shell&#x2F;mongo.js:99:12</span><br><span class="line">shellHelper.show@src&#x2F;mongo&#x2F;shell&#x2F;utils.js:937:13</span><br><span class="line">shellHelper@src&#x2F;mongo&#x2F;shell&#x2F;utils.js:819:15</span><br><span class="line">@(shellhelp2):1:1</span><br></pre></td></tr></table></figure>
发现，不能读取集合的数据。当前从节点只是一个备份，不是奴隶节点，无法读取数据，写当然更不行。因为默认情况下，从节点是没有读写权限的，可以增加读的权限，但需要进行设置。<blockquote>
<p>设置读操作权限：说明：设置为奴隶节点，允许在从成员上运行读的操作<br>命令： rs.secondaryOk()</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">myrs:SECONDARY&gt; rs.secondaryOk()</span><br><span class="line">myrs:SECONDARY&gt; show dbs;</span><br><span class="line">admin      0.000GB</span><br><span class="line">articledb  0.000GB</span><br><span class="line">config     0.000GB</span><br><span class="line">local      0.000GB</span><br><span class="line">myrs:SECONDARY&gt; use articledb</span><br><span class="line">switched to db articledb</span><br><span class="line">myrs:SECONDARY&gt; show collections</span><br><span class="line">comment</span><br><span class="line">myrs:SECONDARY&gt; db.comment.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;6041130aaa5b546e2eba2dfd&quot;), &quot;articleid&quot; : &quot;100000&quot;, &quot;content&quot; : &quot;今天天气真好，阳光明媚&quot;, &quot;userid&quot; : &quot;1001&quot;, &quot;nickname&quot; : &quot;Rose&quot;, &quot;createdatetime&quot; : ISODate(&quot;2021-03-04T17:04:10.913Z&quot;) &#125;</span><br><span class="line">myrs:SECONDARY&gt; db.comment.insert(&#123;&quot;_id&quot;:&quot;1&quot;,&quot;articleid&quot;:&quot;100001&quot;,&quot;content&quot;:&quot;我们不应该把清晨浪费在手机上，健康很重要，k一杯温水幸福你我他。&quot;,&quot;userid&quot;:&quot;1002&quot;,&quot;nickname&quot;:&quot;相忘于 江湖&quot;,&quot;createdatetime&quot;:new Date(&quot;2019-08-05T22:08:15.522Z&quot;),&quot;likenum&quot;:NumberInt(1000),&quot;state&quot;:&quot;1&quot;&#125;)</span><br><span class="line">WriteCommandError(&#123;</span><br><span class="line">        &quot;topologyVersion&quot; : &#123;</span><br><span class="line">                &quot;processId&quot; : ObjectId(&quot;6041058376f8cdece45c5d17&quot;),</span><br><span class="line">                &quot;counter&quot; : NumberLong(4)</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;operationTime&quot; : Timestamp(1614877939, 1),</span><br><span class="line">        &quot;ok&quot; : 0,</span><br><span class="line">        &quot;errmsg&quot; : &quot;not master&quot;,</span><br><span class="line">        &quot;code&quot; : 10107,</span><br><span class="line">        &quot;codeName&quot; : &quot;NotWritablePrimary&quot;,</span><br><span class="line">        &quot;$clusterTime&quot; : &#123;</span><br><span class="line">                &quot;clusterTime&quot; : Timestamp(1614877939, 1),</span><br><span class="line">                &quot;signature&quot; : &#123;</span><br><span class="line">                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">                        &quot;keyId&quot; : NumberLong(0)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
现在可实现了读写分离，让主插入数据，让从来读取数据。<br>如果要取消作为奴隶节点的读权限：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">myrs:SECONDARY&gt; rs.secondaryOk(false)</span><br><span class="line">myrs:SECONDARY&gt; db.comment.find() </span><br><span class="line">Error: error: &#123;</span><br><span class="line">        &quot;topologyVersion&quot; : &#123;</span><br><span class="line">                &quot;processId&quot; : ObjectId(&quot;6041058376f8cdece45c5d17&quot;),</span><br><span class="line">                &quot;counter&quot; : NumberLong(4)</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;operationTime&quot; : Timestamp(1614877999, 1),</span><br><span class="line">        &quot;ok&quot; : 0,</span><br><span class="line">        &quot;errmsg&quot; : &quot;not master and slaveOk&#x3D;false&quot;,</span><br><span class="line">        &quot;code&quot; : 13435,</span><br><span class="line">        &quot;codeName&quot; : &quot;NotPrimaryNoSecondaryOk&quot;,</span><br><span class="line">        &quot;$clusterTime&quot; : &#123;</span><br><span class="line">                &quot;clusterTime&quot; : Timestamp(1614877999, 1),</span><br><span class="line">                &quot;signature&quot; : &#123;</span><br><span class="line">                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">                        &quot;keyId&quot; : NumberLong(0)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
3、仲裁者节点，不存放任何业务数据的，可以登录查看<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">myrs:ARBITER&gt; rs.secondaryOk()</span><br><span class="line">myrs:ARBITER&gt; show dbs</span><br><span class="line">uncaught exception: Error: listDatabases failed:&#123;</span><br><span class="line">        &quot;topologyVersion&quot; : &#123;</span><br><span class="line">                &quot;processId&quot; : ObjectId(&quot;6041064174487a9d81c3f122&quot;),</span><br><span class="line">                &quot;counter&quot; : NumberLong(1)</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ok&quot; : 0,</span><br><span class="line">        &quot;errmsg&quot; : &quot;node is not in primary or recovering state&quot;,</span><br><span class="line">        &quot;code&quot; : 13436,</span><br><span class="line">        &quot;codeName&quot; : &quot;NotPrimaryOrSecondary&quot;</span><br><span class="line">&#125; :</span><br><span class="line">_getErrorWithCode@src&#x2F;mongo&#x2F;shell&#x2F;utils.js:25:13</span><br><span class="line">Mongo.prototype.getDBs&#x2F;&lt;@src&#x2F;mongo&#x2F;shell&#x2F;mongo.js:147:19</span><br><span class="line">Mongo.prototype.getDBs@src&#x2F;mongo&#x2F;shell&#x2F;mongo.js:99:12</span><br><span class="line">shellHelper.show@src&#x2F;mongo&#x2F;shell&#x2F;utils.js:937:13</span><br><span class="line">shellHelper@src&#x2F;mongo&#x2F;shell&#x2F;utils.js:819:15</span><br><span class="line">@(shellhelp2):1:1</span><br><span class="line">myrs:ARBITER&gt; use local</span><br><span class="line">switched to db local</span><br><span class="line">myrs:ARBITER&gt; show collections</span><br><span class="line">replset.election</span><br><span class="line">replset.minvalid</span><br><span class="line">replset.oplogTruncateAfterPoint</span><br><span class="line">startup_log</span><br><span class="line">system.replset</span><br><span class="line">system.rollback.id</span><br></pre></td></tr></table></figure>
仲裁者节点不能读取数据库，只存放了副本集配置等数据<h3 id="主节点的选举原则"><a href="#主节点的选举原则" class="headerlink" title="主节点的选举原则"></a>主节点的选举原则</h3><h4 id="主节点选举的触发条件"><a href="#主节点选举的触发条件" class="headerlink" title="主节点选举的触发条件"></a>主节点选举的触发条件</h4>MongoDB在副本集中，会自动进行主节点的选举，主节点选举的触发条件：<br>1） 主节点故障<br>2） 主节点网络不可达（默认心跳信息为10秒）<br>3） 人工干预（rs.stepDown(600)）<h4 id="选举规则"><a href="#选举规则" class="headerlink" title="选举规则"></a>选举规则</h4>选举规则是根据<strong>票数</strong>来决定谁获胜：<br>1）票数最高，且获得了<strong>“大多数”</strong>成员的投票支持的节点获胜。“大多数”的定义为：假设复制集内投票成员数量为N，则大多数为 N/2 + 1。例如：3个投票成员，则大多数的值是2。当复制集内存活成员数量不足大多数时，整个复制集将无法选举出Primary，复制集将无法提供写服务，处于只读状态。<br>2）若票数相同，且都获得了“大多数”成员的投票支持的，数据新的节点获胜。数据的新旧是通过操作日志oplog来对比的。<br>3）在获得票数的时候，优先级（priority）参数影响重大。<br>可以通过设置优先级（priority）来设置额外票数。优先级即权重，取值为0-1000，相当于可额外增加0-1000的票数，优先级的值越大，就越可能获得多数成员的投票（votes）数。指定较高的值可使成员更有资格成为主要成员，更低的值可使成员更不符合条件。主节点和副本节点的优先级各为1，即，默认可以认为都已经有了一票。<strong>选举节点的优先级必须是0</strong>，不能是别的值。即不具备选举权，但具有投票权。<h4 id="修改优先级"><a href="#修改优先级" class="headerlink" title="修改优先级"></a>修改优先级</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"># 先将配置导入cfg变量</span><br><span class="line">myrs:PRIMARY&gt; cfg&#x3D;rs.conf()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : &quot;myrs&quot;,</span><br><span class="line">        &quot;version&quot; : 3,</span><br><span class="line">        &quot;term&quot; : 1,</span><br><span class="line">        &quot;protocolVersion&quot; : NumberLong(1),</span><br><span class="line">        &quot;writeConcernMajorityJournalDefault&quot; : true,</span><br><span class="line">        &quot;members&quot; : [</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 0,</span><br><span class="line">                        &quot;host&quot; : &quot;localhost:27018&quot;,</span><br><span class="line">                        &quot;arbiterOnly&quot; : false,</span><br><span class="line">                        &quot;buildIndexes&quot; : true,</span><br><span class="line">                        &quot;hidden&quot; : false,</span><br><span class="line">                        &quot;priority&quot; : 1,</span><br><span class="line">                        &quot;tags&quot; : &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;slaveDelay&quot; : NumberLong(0),</span><br><span class="line">                        &quot;votes&quot; : 1</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 1,</span><br><span class="line">                        &quot;host&quot; : &quot;localhost:27019&quot;,</span><br><span class="line">                        &quot;arbiterOnly&quot; : false,</span><br><span class="line">                        &quot;buildIndexes&quot; : true,</span><br><span class="line">                        &quot;hidden&quot; : false,</span><br><span class="line">                        &quot;priority&quot; : 1,</span><br><span class="line">                        &quot;tags&quot; : &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;slaveDelay&quot; : NumberLong(0),</span><br><span class="line">                        &quot;votes&quot; : 1</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 2,</span><br><span class="line">                        &quot;host&quot; : &quot;localhost:27020&quot;,</span><br><span class="line">                        &quot;arbiterOnly&quot; : true,</span><br><span class="line">                        &quot;buildIndexes&quot; : true,</span><br><span class="line">                        &quot;hidden&quot; : false,</span><br><span class="line">                        &quot;priority&quot; : 0,</span><br><span class="line">                        &quot;tags&quot; : &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;slaveDelay&quot; : NumberLong(0),</span><br><span class="line">                        &quot;votes&quot; : 1</span><br><span class="line">                &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;settings&quot; : &#123;</span><br><span class="line">                &quot;chainingAllowed&quot; : true,</span><br><span class="line">                &quot;heartbeatIntervalMillis&quot; : 2000,</span><br><span class="line">                &quot;heartbeatTimeoutSecs&quot; : 10,</span><br><span class="line">                &quot;electionTimeoutMillis&quot; : 10000,</span><br><span class="line">                &quot;catchUpTimeoutMillis&quot; : -1,</span><br><span class="line">                &quot;catchUpTakeoverDelayMillis&quot; : 30000,</span><br><span class="line">                &quot;getLastErrorModes&quot; : &#123;</span><br><span class="line"></span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;getLastErrorDefaults&quot; : &#123;</span><br><span class="line">                        &quot;w&quot; : 1,</span><br><span class="line">                        &quot;wtimeout&quot; : 0</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;replicaSetId&quot; : ObjectId(&quot;60410b7f1f17f19cfc27cd7b&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 然后修改值（ID号默认从0开始）</span><br><span class="line">myrs:PRIMARY&gt; cfg.members[1].priority&#x3D;2</span><br><span class="line">2</span><br><span class="line"># 重新加载配置</span><br><span class="line">myrs:PRIMARY&gt; rs.reconfig(cfg)</span><br><span class="line">&#123;</span><br><span class="line">        &quot;ok&quot; : 1,</span><br><span class="line">        &quot;$clusterTime&quot; : &#123;</span><br><span class="line">                &quot;clusterTime&quot; : Timestamp(1614878769, 2),</span><br><span class="line">                &quot;signature&quot; : &#123;</span><br><span class="line">                        &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA&#x3D;&quot;),</span><br><span class="line">                        &quot;keyId&quot; : NumberLong(0)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;operationTime&quot; : Timestamp(1614878769, 2)</span><br><span class="line">&#125;</span><br><span class="line">myrs:PRIMARY&gt; rs.conf()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : &quot;myrs&quot;,</span><br><span class="line">        &quot;version&quot; : 4,</span><br><span class="line">        &quot;term&quot; : 2,</span><br><span class="line">        &quot;protocolVersion&quot; : NumberLong(1),</span><br><span class="line">        &quot;writeConcernMajorityJournalDefault&quot; : true,</span><br><span class="line">        &quot;members&quot; : [</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 0,</span><br><span class="line">                        &quot;host&quot; : &quot;localhost:27018&quot;,</span><br><span class="line">                        &quot;arbiterOnly&quot; : false,</span><br><span class="line">                        &quot;buildIndexes&quot; : true,</span><br><span class="line">                        &quot;hidden&quot; : false,</span><br><span class="line">                        &quot;priority&quot; : 1,</span><br><span class="line">                        &quot;tags&quot; : &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;slaveDelay&quot; : NumberLong(0),</span><br><span class="line">                        &quot;votes&quot; : 1</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 1,</span><br><span class="line">                        &quot;host&quot; : &quot;localhost:27019&quot;,</span><br><span class="line">                        &quot;arbiterOnly&quot; : false,</span><br><span class="line">                        &quot;buildIndexes&quot; : true,</span><br><span class="line">                        &quot;hidden&quot; : false,</span><br><span class="line">                        &quot;priority&quot; : 2,</span><br><span class="line">                        &quot;tags&quot; : &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;slaveDelay&quot; : NumberLong(0),</span><br><span class="line">                        &quot;votes&quot; : 1</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                        &quot;_id&quot; : 2,</span><br><span class="line">                        &quot;host&quot; : &quot;localhost:27020&quot;,</span><br><span class="line">                        &quot;arbiterOnly&quot; : true,</span><br><span class="line">                        &quot;buildIndexes&quot; : true,</span><br><span class="line">                        &quot;hidden&quot; : false,</span><br><span class="line">                        &quot;priority&quot; : 0,</span><br><span class="line">                        &quot;tags&quot; : &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;slaveDelay&quot; : NumberLong(0),</span><br><span class="line">                        &quot;votes&quot; : 1</span><br><span class="line">                &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;settings&quot; : &#123;</span><br><span class="line">                &quot;chainingAllowed&quot; : true,</span><br><span class="line">                &quot;heartbeatIntervalMillis&quot; : 2000,</span><br><span class="line">                &quot;heartbeatTimeoutSecs&quot; : 10,</span><br><span class="line">                &quot;electionTimeoutMillis&quot; : 10000,</span><br><span class="line">                &quot;catchUpTimeoutMillis&quot; : -1,</span><br><span class="line">                &quot;catchUpTakeoverDelayMillis&quot; : 30000,</span><br><span class="line">                &quot;getLastErrorModes&quot; : &#123;</span><br><span class="line"></span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;getLastErrorDefaults&quot; : &#123;</span><br><span class="line">                        &quot;w&quot; : 1,</span><br><span class="line">                        &quot;wtimeout&quot; : 0</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;replicaSetId&quot; : ObjectId(&quot;60410b7f1f17f19cfc27cd7b&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>片刻后重新选举，主节点变成了从节点<br>![重新选举](mongodb集群/20210305012837564_5226.png =800x)</p>
<h3 id="故障测试"><a href="#故障测试" class="headerlink" title="故障测试"></a>故障测试</h3><h4 id="副本节点故障测试"><a href="#副本节点故障测试" class="headerlink" title="副本节点故障测试"></a>副本节点故障测试</h4><p>关闭27018副本节点，上一步他已经成为了从节点<br>在主节点27019插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">myrs:PRIMARY&gt; db.comment.insert(&#123;&quot;_id&quot;:&quot;1&quot;,&quot;articleid&quot;:&quot;100001&quot;,&quot;content&quot;:&quot;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&quot;,&quot;userid&quot;:&quot;1002&quot;,&quot;nickname&quot;:&quot;相忘于江湖&quot;,&quot;createdatetime&quot;:new Date(&quot;2019-08-05T22:08:15.522Z&quot;),&quot;likenum&quot;:NumberInt(1000),&quot;state&quot;:&quot;1&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure>
<p>再启动从节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">D:\software\MongoDB\Server\4.4\replica_sets\myrs_27018&gt;D:\software\MongoDB\Server\4.4\bin\mongod -f D:\software\MongoDB\Server\4.4\replica_sets\myrs_27018\mongod.conf</span><br><span class="line">查看数据库</span><br><span class="line">myrs:SECONDARY&gt; rs.secondaryOk()</span><br><span class="line">myrs:SECONDARY&gt; db.comment.find()</span><br><span class="line">&#123; &quot;_id&quot; : &quot;1&quot;, &quot;articleid&quot; : &quot;100001&quot;, &quot;content&quot; : &quot;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&quot;, &quot;userid&quot; : &quot;1002&quot;, &quot;nickname&quot; : &quot;相忘于江湖&quot;, &quot;createdatetime&quot; : ISODate(&quot;2019-08-05T22:08:15.522Z&quot;), &quot;likenum&quot; : 1000, &quot;state&quot; : &quot;1&quot; &#125;</span><br></pre></td></tr></table></figure>
<p>主节点写入的数据，会自动同步给从节点</p>
<h4 id="主节点故障测试"><a href="#主节点故障测试" class="headerlink" title="主节点故障测试"></a>主节点故障测试</h4><p>关闭27019节点<br>![关闭主节点](mongodb集群/20210305013636429_13236.png =800x)<br>从节点和仲裁节点对27019的心跳失败，当失败超过10秒，此时因为没有主节点了，会自动发起投票。而副本节点只有27018，因此，候选人只有一个就是27018，开始投票。27020向27018投了一票，27018本身自带一票，因此共两票，超过了“大多数”。27020是仲裁节点，没有选举权，27018不向其投票，其票数是0.最终结果，27018成为主节点。具备读写功能。<br>![从节点变为主节点](mongodb集群/20210305013824592_2794.png =800x)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 在主节点插入数据</span><br><span class="line">myrs:PRIMARY&gt; db.comment.insert(&#123;&quot;_id&quot;:&quot;2&quot;,&quot;articleid&quot;:&quot;100001&quot;,&quot;content&quot;:&quot;我夏天空腹喝凉开水，冬天喝温开水&quot;,&quot;userid&quot;:&quot;1005&quot;,&quot;nickname&quot;:&quot;伊人憔悴&quot;,&quot;createdatetime&quot;:new Date(&quot;2019-08-05T23:58:51.485Z&quot;),&quot;likenum&quot;:NumberInt(888),&quot;state&quot;:&quot;1&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line"># 再启动27019节点</span><br><span class="line">D:\software\MongoDB\Server\4.4\replica_sets\myrs_27019&gt;D:\software\MongoDB\Server\4.4\bin\mongod -f D:\software\MongoDB\Server\4.4\replica_sets\myrs_27019\mongod.conf</span><br><span class="line"># 登录27019</span><br><span class="line">D:\software\MongoDB\Server\4.4\bin&gt;mongo --host&#x3D;127.0.0.1 --port&#x3D;27019</span><br><span class="line">MongoDB shell version v4.4.4</span><br><span class="line"># 发现27019仍为主节点，因为优先级高，但数据自动从27019同步。实现了高可用。</span><br><span class="line">myrs:PRIMARY&gt; db.comment.find()                                                       凉开水，冬                                                   te&quot;:&quot;1&quot;&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : &quot;1&quot;, &quot;articleid&quot; : &quot;100001&quot;, &quot;content&quot; : &quot;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&quot;, &quot;userid&quot; : &quot;1002&quot;, &quot;nickname&quot; : &quot;相忘于江湖&quot;, &quot;createdatetime&quot; : ISODate(&quot;2019-08-05T22:08:15.522Z&quot;), &quot;likenum&quot; : 1000, &quot;state&quot; : &quot;1&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot;2&quot;, &quot;articleid&quot; : &quot;100001&quot;, &quot;content&quot; : &quot;我夏天空腹喝凉开水，冬天喝温开水&quot;, &quot;userid&quot; : &quot;1005&quot;, &quot;nickname&quot; : &quot;伊人憔悴&quot;, &quot;createdatetime&quot; : ISODate(&quot;2019-08-05T23:58:51.485Z&quot;), &quot;likenum&quot; : 888, &quot;state&quot; : &quot;1&quot; &#125;</span><br></pre></td></tr></table></figure>
<h4 id="仲裁节点和主节点故障"><a href="#仲裁节点和主节点故障" class="headerlink" title="仲裁节点和主节点故障"></a>仲裁节点和主节点故障</h4><p>先关掉仲裁节点27020，关掉现在的主节点27019，登录27018后，发现，27018仍然是从节点，副本集中没有主节点了，导致此时，副本集是只读状态，无法写入。<br>为啥不选举了？因为27018的票数，没有获得大多数，即没有大于等于2，它只有默认的一票（优先级是1）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\software\MongoDB\Server\4.4\bin&gt;mongo --host&#x3D;127.0.0.1 --port&#x3D;27018</span><br><span class="line">MongoDB shell version v4.4.4</span><br><span class="line">connecting to: mongodb:&#x2F;&#x2F;127.0.0.1:27018&#x2F;?compressors&#x3D;disabled&amp;gssapiServiceName&#x3D;mongodb</span><br><span class="line">Implicit session: session &#123; &quot;id&quot; : UUID(&quot;c209fd88-7a8a-48a9-a739-cf277d5caae0&quot;) &#125;</span><br><span class="line">MongoDB server version: 4.4.4</span><br><span class="line">myrs:SECONDARY&gt;</span><br></pre></td></tr></table></figure>
<p>如果要触发选举，随便加入一个成员即可。<br>如果只加入27020仲裁节点成员，则主节点一定是27018，因为没得选了，仲裁节点不参与选举，但参与投票。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 加入仲裁节点后，发现27018从从节点变成主节点</span><br><span class="line">myrs:SECONDARY&gt;</span><br><span class="line">myrs:PRIMARY&gt;</span><br></pre></td></tr></table></figure>

<p>如果只加入27019节点，会发起选举。因为27018两票，27019是三票，所以27019作为主节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 启动27019（优先级为2的节点）</span><br><span class="line">D:\software\MongoDB\Server\4.4\replica_sets\myrs_27019&gt;D:\software\MongoDB\Server\4.4\bin\mongod -f D:\software\MongoDB\Server\4.4\replica_sets\myrs_27019\mongod.conf</span><br><span class="line">myrs:SECONDARY&gt;</span><br><span class="line">myrs:PRIMARY&gt;</span><br><span class="line"># 27018最后变成了从节点</span><br><span class="line">myrs:SECONDARY&gt;</span><br></pre></td></tr></table></figure>
<h4 id="仲裁节点和从节点故障"><a href="#仲裁节点和从节点故障" class="headerlink" title="仲裁节点和从节点故障"></a>仲裁节点和从节点故障</h4><p>先关掉仲裁节点27020，<br>关掉现在的副本节点27018<br>10秒后，27019主节点自动降级为副本节点。（服务降级）<br>副本集不可写数据了，已经故障了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\software\MongoDB\Server\4.4\bin&gt;mongo --host&#x3D;127.0.0.1 --port&#x3D;27019</span><br><span class="line">MongoDB shell version v4.4.4</span><br><span class="line">connecting to: mongodb:&#x2F;&#x2F;127.0.0.1:27019&#x2F;?compressors&#x3D;disabled&amp;gssapiServiceName&#x3D;mongodb</span><br><span class="line">Implicit session: session &#123; &quot;id&quot; : UUID(&quot;b04aecb3-df34-40e1-9544-20bd079bb771&quot;) &#125;</span><br><span class="line">MongoDB server version: 4.4.4</span><br><span class="line">myrs:SECONDARY&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Compass连接副本集"><a href="#Compass连接副本集" class="headerlink" title="Compass连接副本集"></a>Compass连接副本集</h3><p>![ip端口配置](mongodb集群/20210305015848274_23260.png =800x)<br>![副本集配置](mongodb集群/20210305015909222_31597.png =800x)<br>![副本集](mongodb集群/20210305015937572_10190.png =800x)</p>
<h3 id="python连接副本集"><a href="#python连接副本集" class="headerlink" title="python连接副本集"></a>python连接副本集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import pymongo</span><br><span class="line">from pymongo import MongoClient</span><br><span class="line">from pymongo import ReadPreference</span><br><span class="line">import time</span><br><span class="line">import argparse</span><br><span class="line"># 定义执行时长装饰器函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def warps(*args):</span><br><span class="line">    def deco(func):</span><br><span class="line">        def _deco(*args, **kwargs):</span><br><span class="line">            # 记录开始时间</span><br><span class="line">            start &#x3D; time.clock()</span><br><span class="line">            # 回调原函数</span><br><span class="line">            func(*args, **kwargs)</span><br><span class="line">            # 记录结束时间</span><br><span class="line">            end &#x3D; time.clock()</span><br><span class="line">            # 计算执行时长</span><br><span class="line">            delat &#x3D; end - start</span><br><span class="line">            # 转换成ms输出</span><br><span class="line">            print(&quot;delay:%sms&quot; % (int(delat*1000)))</span><br><span class="line">        return _deco</span><br><span class="line">    return deco</span><br><span class="line"></span><br><span class="line"># 连接副本集</span><br><span class="line">conn &#x3D; MongoClient([&#39;127.0.0.1:27018&#39;, &#39;127.0.0.1:27019&#39;, &#39;127.0.0.1:27020&#39;])</span><br><span class="line"># 读写分离</span><br><span class="line">db &#x3D; conn.get_database(&#39;hnrtest&#39;, read_preference&#x3D;ReadPreference.SECONDARY_PREFERRED)</span><br><span class="line"># 定义连接的集合</span><br><span class="line">collection &#x3D; db.student</span><br><span class="line"># 创建插入数据函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def data_insert(num):</span><br><span class="line">    try:</span><br><span class="line">        for i in range(1, num):</span><br><span class="line">            collection.insert(&#123;&quot;name&quot;: &quot;student&quot;+str(i), &quot;age&quot;: (i % 100), &quot;city&quot;: &quot;FuZhou&quot;&#125;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;insert data:&quot;, e)</span><br><span class="line"># 创建查询数据函数，引用装饰器函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@warps()</span><br><span class="line">def data_select(num):</span><br><span class="line">    try:</span><br><span class="line">        count &#x3D; collection.find().count()</span><br><span class="line">        while count !&#x3D; num - 1:</span><br><span class="line">            count &#x3D; collection.find().count()</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;select data:&quot;, e)</span><br><span class="line"># 创建删除数据函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def data_delete():</span><br><span class="line">    try:</span><br><span class="line">        collection.remove(&#123;&#125;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;delete data:&quot;, e)</span><br><span class="line"># 创建计算延迟时长函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def data_delay(num):</span><br><span class="line">    data_insert(num)</span><br><span class="line">    data_select(num)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    # 定义脚本需要传入插入的数据量，默认值为1000，通过-n传入参数</span><br><span class="line">    parser &#x3D; argparse.ArgumentParser(description&#x3D;&#39;insert data to mongodb number&#39;)</span><br><span class="line">    parser.add_argument(&#39;-n&#39;, action&#x3D;&#39;store&#39;, dest&#x3D;&#39;num&#39;, type&#x3D;int, required&#x3D;False, default&#x3D;1000)</span><br><span class="line">    given_args &#x3D; parser.parse_args()</span><br><span class="line">    num &#x3D; given_args.num</span><br><span class="line">    data_delete()</span><br><span class="line">    data_delay(num)</span><br></pre></td></tr></table></figure>
<h2 id="分片集群-Sharded-Cluster"><a href="#分片集群-Sharded-Cluster" class="headerlink" title="分片集群-Sharded Cluster"></a>分片集群-Sharded Cluster</h2><h3 id="分片概念"><a href="#分片概念" class="headerlink" title="分片概念"></a>分片概念</h3><p>分片（sharding）是一种<strong>跨多台机器分布数据</strong>的方法， MongoDB使用<strong>分片</strong>来支持具有<strong>非常大</strong>的数据集和<strong>高吞吐量操作</strong>的部署。</p>
<h4 id="为什么需要分片？"><a href="#为什么需要分片？" class="headerlink" title="为什么需要分片？"></a>为什么需要分片？</h4><p>具有大型数据集或高吞吐量应用程序的数据库系统可以会挑战单个服务器的容量。例如，高查询率会耗尽服务器的CPU容量。工作集大小大于系统的RAM会强调磁盘驱动器的I / O容量。<br>有两种解决系统增长的方法：垂直扩展和水平扩展</p>
<blockquote>
<p>垂直扩展：即在单台服务器上进行扩展，使它的CPU更强大或者添加更多的RAM增加容量，但垂直扩展具有实际的最大值<br>水平扩展：即划分系统数据集并加载多个服务器，添加其他服务器以根据需要增加容量。虽然单个机器的总体速度或容量可能不高，但每台机器处理整个工作负载的子集，可能提供比单个高速大容量服务器更高的效率。扩展部署容量只需要根据需要添加额外的服务器，这可能比单个机器的高端硬件的总体成本更低。但是基础架构和部署维护的复杂性增加。MongoDB支持通过分片进行水平扩展。</p>
</blockquote>
<h3 id="分片集群包含的组件"><a href="#分片集群包含的组件" class="headerlink" title="分片集群包含的组件"></a>分片集群包含的组件</h3><p>MongoDB分片群集包含以下组件：</p>
<ul>
<li>分片（存储）：每个分片包含分片数据的子集。 每个分片都可以部署为副本集。</li>
<li>mongos（路由）：mongos充当查询路由器，在客户端应用程序和分片集群之间提供接口。</li>
<li>config servers（“调度”的配置）：配置服务器存储群集的元数据和配置设置。 从MongoDB 3.4开始，必须将配置服务器部署为副本集（CSRS）。<br>![分片集群中组件的交互](mongodb集群/20210306000910191_26224.png =800x)<br>MongoDB在集合级别对数据进行分片，将集合数据分布在集群中的分片上。<h3 id="分片集群架构目标"><a href="#分片集群架构目标" class="headerlink" title="分片集群架构目标"></a>分片集群架构目标</h3>两个分片节点副本集（3+3）+一个配置节点副本集（3）+两个路由节点（2），共11个服务节点。<br>![](mongodb集群/20210306010523066_23683.png =800x)<br>客户端访问路由节点，路由节点获取配置节点的分片配置，将数据进行分片。分片规则有两种：哈希规则和范围规则，哈希规则能将数据平均写入各个分片节点，但查询可能要遍历所有的节点。范围规则查询定位节点比较容易，但有热点数据时，可能会引起分片节点的写入不均衡<br>操作顺序：<br>1、分片节点副本集创建<br>1）配置文件需要写入分片的角色<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sharding:</span><br><span class="line">#分片角色</span><br><span class="line">clusterRole: shardsvr</span><br></pre></td></tr></table></figure>
2）添加节点<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rs.initiate() # 初始化副本集</span><br><span class="line">rs.add(&quot;180.76.159.126:27118&quot;) # 从节点</span><br><span class="line">rs.addArb(&quot;180.76.159.126:27218&quot;) # 仲裁节点</span><br></pre></td></tr></table></figure>
3）配置第二套副本集<br>2、配置节点副本集创建<br>1）配置文件写入分片的角色<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sharding:</span><br><span class="line">clusterRole: configsvr</span><br></pre></td></tr></table></figure>
2）配置一主两从<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rs.initiate() # 初始化副本集</span><br><span class="line">rs.add(&quot;180.76.159.126:27119&quot;)</span><br><span class="line">rs.add(&quot;180.76.159.126:27219&quot;)</span><br></pre></td></tr></table></figure>
3、路由节点的创建和添加<br>1）路由节点配置分片角色<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sharding:</span><br><span class="line">    #指定配置节点副本集</span><br><span class="line">    configDB:</span><br><span class="line">        myconfigrs&#x2F;180.76.159.126:27019,180.76.159.126:27119,180.76.159.126:27219</span><br></pre></td></tr></table></figure>
2）路由节点的配置文件<br>properties配置文件参考<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">logpath&#x3D;&#x2F;mongodb&#x2F;sharded_cluster&#x2F;mymongos_27017&#x2F;log&#x2F;mongos.log</span><br><span class="line">logappend&#x3D;true</span><br><span class="line">bind_ip_all&#x3D;true</span><br><span class="line">port&#x3D;27017</span><br><span class="line">fork&#x3D;true</span><br><span class="line">configdb&#x3D;myconfigrs&#x2F;180.76.159.126:27019,180.76.159.126:27119,180.76.159.126:27219</span><br></pre></td></tr></table></figure>
3）在路由节点上进行分片配置操作<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 添加分片，语法</span><br><span class="line">sh.addShard(&quot;IP:Port&quot;)</span><br><span class="line"># 将第一套分片副本集添加进来：</span><br><span class="line">sh.addShard(&quot;myshardrs01&#x2F;192.168.0.2:27018,180.76.159.126:27118,180.76.159.126:27218&quot;)</span><br><span class="line"># 继续将第二套分片副本集添加进来：</span><br><span class="line">sh.addShard(&quot;myshardrs02&#x2F;192.168.0.2:27318,180.76.159.126:27418,180.76.159.126:27518&quot;)</span><br></pre></td></tr></table></figure>
4）出现问题可移除分片<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.runCommand( &#123; removeShard: &quot;myshardrs02&quot; &#125; )</span><br><span class="line">注意：如果只剩下最后一个shard，是无法删除的</span><br><span class="line">移除时会自动转移分片数据，需要一个时间过程。</span><br><span class="line">完成后，再次执行删除分片命令才能真正删除。</span><br></pre></td></tr></table></figure>
5）开启分片功能：sh.enableSharding(“库名”)、sh.shardCollection(“库名.集合名”,{“key”:1})</li>
<li><em>sh.enableSharding(“库名”)*</em></li>
<li><em>sh.shardCollection(namespace, key, unique)*</em><br>对集合进行分片时,你需要选择一个 片键（Shard Key） , shard key 是每条记录都必须包含的,且建立了索引的单个字段或复合字段,MongoDB按照片键将数据划分到不同的 数据块 中,并将 数据块 均衡地分布到所有分片中.为了按照片键划分数据块,MongoDB使用 基于哈希的分片方式（随机平均分配）或者基于范围的分片方式（数值大小分配） 。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 在mongos上的articledb数据库配置sharding:</span><br><span class="line">sh.enableSharding(&quot;articledb&quot;)</span><br><span class="line"># 集合分片,使用 sh.shardCollection() 方法指定集合和分片键</span><br><span class="line">sh.shardCollection(&quot;articledb.comment&quot;,&#123;&quot;nickname&quot;:&quot;hashed&quot;&#125;) # 哈希</span><br><span class="line">sh.shardCollection(&quot;articledb.author&quot;,&#123;&quot;age&quot;:1&#125;) # 范围</span><br></pre></td></tr></table></figure>
6）添加另外一个路由节点，直接加配置文件及启动即可，无需再次配置分配策略，直接从配置服务器读取</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/03/07/mongodb%E5%9F%BA%E7%A1%80/" rel="prev" title="mongodb基础">
      <i class="fa fa-chevron-left"></i> mongodb基础
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/03/07/mongodb%E5%AE%89%E5%85%A8/" rel="next" title="mongodb安全">
      mongodb安全 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#mongodb集群"><span class="nav-number">1.</span> <span class="nav-text">mongodb集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#副本集-Replica-Sets"><span class="nav-number">1.1.</span> <span class="nav-text">副本集-Replica Sets</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#副本集的三个角色"><span class="nav-number">1.1.1.</span> <span class="nav-text">副本集的三个角色</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#两种类型："><span class="nav-number">1.1.1.1.</span> <span class="nav-text">两种类型：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三种角色："><span class="nav-number">1.1.1.2.</span> <span class="nav-text">三种角色：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#仲裁者"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">仲裁者</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#副本集的创建"><span class="nav-number">1.1.2.</span> <span class="nav-text">副本集的创建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建文件目录及配置文件"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">创建文件目录及配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启动节点"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">启动节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#初始化配置副本集和主节点"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">初始化配置副本集和主节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看副本集的配置内容"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">查看副本集的配置内容</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看副本集状态"><span class="nav-number">1.1.2.5.</span> <span class="nav-text">查看副本集状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加副本从节点"><span class="nav-number">1.1.2.6.</span> <span class="nav-text">添加副本从节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加仲裁从节点"><span class="nav-number">1.1.2.7.</span> <span class="nav-text">添加仲裁从节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#副本集的数据读写操作"><span class="nav-number">1.1.2.8.</span> <span class="nav-text">副本集的数据读写操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主节点的选举原则"><span class="nav-number">1.1.3.</span> <span class="nav-text">主节点的选举原则</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#主节点选举的触发条件"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">主节点选举的触发条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#选举规则"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">选举规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改优先级"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">修改优先级</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#故障测试"><span class="nav-number">1.1.4.</span> <span class="nav-text">故障测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#副本节点故障测试"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">副本节点故障测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#主节点故障测试"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">主节点故障测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#仲裁节点和主节点故障"><span class="nav-number">1.1.4.3.</span> <span class="nav-text">仲裁节点和主节点故障</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#仲裁节点和从节点故障"><span class="nav-number">1.1.4.4.</span> <span class="nav-text">仲裁节点和从节点故障</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Compass连接副本集"><span class="nav-number">1.1.5.</span> <span class="nav-text">Compass连接副本集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python连接副本集"><span class="nav-number">1.1.6.</span> <span class="nav-text">python连接副本集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分片集群-Sharded-Cluster"><span class="nav-number">1.2.</span> <span class="nav-text">分片集群-Sharded Cluster</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#分片概念"><span class="nav-number">1.2.1.</span> <span class="nav-text">分片概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#为什么需要分片？"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">为什么需要分片？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分片集群包含的组件"><span class="nav-number">1.2.2.</span> <span class="nav-text">分片集群包含的组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分片集群架构目标"><span class="nav-number">1.2.3.</span> <span class="nav-text">分片集群架构目标</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Haiyefeng"
      src="/images/a.jpg">
  <p class="site-author-name" itemprop="name">Haiyefeng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Haiyefeng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
